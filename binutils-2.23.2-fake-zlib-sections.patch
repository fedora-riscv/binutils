*** ../binutils-2.23.2.orig/bfd/compress.c	2014-04-28 16:12:03.743891740 +0100
--- bfd/compress.c	2014-04-28 16:20:28.980834659 +0100
***************
*** 25,30 ****
--- 25,31 ----
  #ifdef HAVE_ZLIB_H
  #include <zlib.h>
  #endif
+ #include "safe-ctype.h"
  
  #ifdef HAVE_ZLIB_H
  static bfd_boolean
*************** bfd_boolean
*** 272,282 ****
  bfd_is_section_compressed (bfd *abfd, sec_ptr sec)
  {
    bfd_byte compressed_buffer [12];
  
    /* Read the zlib header.  In this case, it should be "ZLIB" followed
       by the uncompressed section size, 8 bytes in big-endian order.  */
!   return (bfd_get_section_contents (abfd, sec, compressed_buffer, 0, 12)
! 	  && CONST_STRNEQ ((char*) compressed_buffer, "ZLIB"));
  }
  
  /*
--- 273,301 ----
  bfd_is_section_compressed (bfd *abfd, sec_ptr sec)
  {
    bfd_byte compressed_buffer [12];
+   unsigned int saved = sec->compress_status;
+   bfd_boolean compressed;
+ 
+   /* Don't decompress the section.  */
+   sec->compress_status = COMPRESS_SECTION_NONE;
  
    /* Read the zlib header.  In this case, it should be "ZLIB" followed
       by the uncompressed section size, 8 bytes in big-endian order.  */
!   compressed = (bfd_get_section_contents (abfd, sec, compressed_buffer, 0, 12)
! 		&& CONST_STRNEQ ((char*) compressed_buffer, "ZLIB"));
! 
!   /* Check for the pathalogical case of a debug string section that
!      contains the string ZLIB.... as the first entry.  We assume that
!      no uncompressed .debug_str section would ever be big enough to
!      have the first byte of its (big-endian) size be non-zero.  */
!   if (compressed
!       && strcmp (sec->name, ".debug_str") == 0
!       && ISPRINT (compressed_buffer[4]))
!     compressed = FALSE;
! 
!   /* Restore compress_status.  */
!   sec->compress_status = saved;
!   return compressed;
  }
  
  /*
